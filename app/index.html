<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="/styles/jquery.terminal.css" />
        <style type="text/css">
            body {
                background: #1b1b1b;
            }
            #editor, #terminal {
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                position: absolute;
            }
            #editor {
                /*left: 45%;*/
            }
            #terminal {
                /*right: 55%;*/
            }
            .terminal .prompt, .cmd .prompt, .terminal .prompt-history, .cmd .prompt-history, .prompt-history {
                color: #9ee;
            }
        </style>
    </head>
    <body>
        <div id="terminal" class="td"></div>
        <div id="editor">def answer(x):
    # this is a test
</div>
    <div id="statusBar"></div>
        <script type="text/javascript" src="/scripts/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="/scripts/jquery.terminal/jquery.terminal-0.8.8.js"></script>
        <script type="text/javascript" src="/scripts/jquery.terminal/jquery.mousewheel.min.js"></script>
        <script type="text/javascript" src="/scripts/ace/ace.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-monokai.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-clouds_midnight.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-ambiance.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-solarized_dark.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-github.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-pastel_on_dark.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-kr_theme.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-merbivore.js"></script>
        <script type="text/javascript" src="/scripts/ace/theme-merbivore_soft.js"></script>
        <script type="text/javascript" src="/scripts/ace/keybinding-vim.js"></script>
        <script type="text/javascript" src="/scripts/ace/keybinding-emacs.js"></script>
        <script type="text/javascript">
            var commands = [];
            var settings = {
                prompt: 'webterm:~/ ',
                name: 'webterm:~/ ',
                enabled: true,
                greetings: "",
                keypress: function(e) {
                    if (e.which == 96) {
                        return false;
                    }
                },
                completion: function(terminal, command, callback) {
                    if (commands.length === 0) {
                        $.getJSON("/exec?cmd=CMDS", function(response) {
                            commands = [];
                            for (var c in response.reply) {
                                commands.push(c.toLowerCase());
                            }
                            callback(commands);
                        });
                    } else {
                        callback(commands);
                    }
                }
            };

            function printResponse(terminal, response, indention) {
                if (typeof response !== 'object') {
                    terminal.echo(response);
                } else {
                    for (var k in response) {
                        if (typeof response[k] !== 'object') {
                            terminal.echo(indention + k + ": " + response[k]);
                        } else {
                            terminal.echo(indention + k)
                            printResponse(terminal, response[k], indention + "  ");
                        }
                    }
                }
                terminal.echo("");
            }

            function eval(command, terminal) {
                $.getJSON("/exec?cmd=" + command, function(response) {
                    if (response.reply) {
                        if (response.cmd === "CMDS") {
                            if (commands.length === 0) {
                                commands = [];
                                for (var k in response.reply) {
                                    commands.push(k.toLowerCase());
                                }
                            }
                            for (var k in response.reply) {
                                terminal.echo(k);
                                terminal.echo("  " + response.reply[k].Description)
                                if (response.reply[k].Usage) {
                                    terminal.echo("  usage: " + response.reply[k].Usage)
                                }
                            }
                            terminal.echo("");
                        } else {
                            printResponse(terminal, response.reply, "");
                        }
                    } else {
                        terminal.echo("");
                    }
                });
            };

            var editor;
            $(document).ready(function($) {
                var terminal = jQuery("#terminal").terminal(eval, settings);
                editor = ace.edit("editor")
                editor.setTheme("ace/theme/monokai");
                editor.getSession().setMode("ace/mode/python");
                //editor.setKeyboardHandler("ace/keyboard/vim");
                editor.resize();
                $("#editor").hide();
            });
        </script>
    </body>
</html>
